<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>issue-tracker documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">issue-tracker documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interceptor">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Interceptors</li>
  <li>FakeBackendInterceptor</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/helpers/fake-backend.ts</code>
        </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#fakeDb">fakeDb</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#intercept">intercept</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#load">load</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#save">save</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor()</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="13" class="link-to-prism">src/app/helpers/fake-backend.ts:13</a></div>
                            </td>
                        </tr>

            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="intercept"></a>
                    <span class="name">
                        <b>
                            intercept
                        </b>
                        <a href="#intercept"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>intercept(req: HttpRequest<any>, next: <a href="https://angular.io/api/common/http/HttpHandler" target="_blank">HttpHandler</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="30"
                            class="link-to-prism">src/app/helpers/fake-backend.ts:30</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>req</td>
                                    <td>
                                            <code>HttpRequest&lt;any&gt;</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>next</td>
                                    <td>
                                                <code><a href="https://angular.io/api/common/http/HttpHandler" target="_blank" >HttpHandler</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Observable&lt;HttpEvent&lt;any&gt;&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="load"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Private</span>
                            load
                        </b>
                        <a href="#load"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>load()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="20"
                            class="link-to-prism">src/app/helpers/fake-backend.ts:20</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="save"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Private</span>
                            save
                        </b>
                        <a href="#save"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>save()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="25"
                            class="link-to-prism">src/app/helpers/fake-backend.ts:25</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="fakeDb"></a>
                        <span class="name">
                            <b>
                            fakeDb</b>
                            <a href="#fakeDb"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="13" class="link-to-prism">src/app/helpers/fake-backend.ts:13</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &quot;@angular/core&quot;;
import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent, HttpResponse, HTTP_INTERCEPTORS } from &#x27;@angular/common/http&#x27;;
import { Observable, of, throwError } from &#x27;rxjs&#x27;;
import { User } from &#x27;../models/user.type&#x27;;
import { mergeMap, materialize, dematerialize, delay } from &#x27;rxjs/operators&#x27;;
import { Issue } from &#x27;../models/issue.type&#x27;;
import { FakeDb } from &#x27;./fake-db&#x27;;
import * as _ from &#x27;lodash&#x27;;
import { Note } from &#x27;../models/note.type&#x27;;

@Injectable()
export class FakeBackendInterceptor implements HttpInterceptor {
    fakeDb: any;

    constructor() {
        // localStorage.clear();
        this.load();
    }

    private load() {
        this.fakeDb &#x3D; JSON.parse(localStorage.getItem(&#x27;fakeDb&#x27;)) || FakeDb;
        this.save();
    }

    private save() {
        localStorage.setItem(&quot;fakeDb&quot;, JSON.stringify(this.fakeDb));
        return of(delay(200));
    }

    intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
        // const authHeader &#x3D; req.headers.get(&quot;Authorization&quot;);
        // const isLoggedIn &#x3D; authHeader &amp;&amp; authHeader.startsWith(&quot;Bearer fake-jwt-token&quot;);
        const isLoggedIn &#x3D; true;

        return of(null).pipe(mergeMap(() &#x3D;&gt; {
            console.log(req.url);

            // if (req.url.endsWith(&quot;/users/auth&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;POST&quot;) {
            //     const user &#x3D; this.fakeDb.Users.find(u &#x3D;&gt; u.username &#x3D;&#x3D;&#x3D; req.body.username &amp;&amp; u.password &#x3D;&#x3D;&#x3D; req.body.password);

            //     if (!user) {
            //         return error(&#x27;Username or password is incorrect&#x27;);
            //     }

            //     return ok({
            //         id: user.id,
            //         email: user.email,
            //         username: user.username,
            //         firstName: user.firstName,
            //         lastName: user.lastName,
            //         userLevelId: user.userLevelId,
            //         token: &quot;fake-jwt-token&quot;
            //     });
            // }

            // if (req.url.endsWith(&quot;/issues/update/&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;POST&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let issue: Issue &#x3D; req.body.issue;
            //     let updateSuccess &#x3D; false;

            //     if (issue.id &gt; 0) {
            //         // update existing issue
            //         for (let i &#x3D; 0; i &lt; this.fakeDb.Issues.length; i++) {
            //             if (this.fakeDb.Issues[i].id &#x3D;&#x3D;&#x3D; issue.id) {
            //                 this.fakeDb.Issues[i] &#x3D; issue;
            //                 updateSuccess &#x3D; true;
            //                 this.save();
            //                 break;
            //             }
            //         }
            //     }
            //     else {
            //         // add new issue
            //         let maxIssue: Issue &#x3D; _.maxBy(this.fakeDb.Issues, i &#x3D;&gt; i.id);
            //         issue.id &#x3D; ((maxIssue &amp;&amp; maxIssue.id) || 0) + 1;

            //         this.fakeDb.Issues.push(issue);
            //         updateSuccess &#x3D; true;
            //         this.save();
            //     }

            //     if (!updateSuccess) {
            //         return error(&quot;The issue you&#x27;re trying to update doesn&#x27;t exist&quot;);
            //     }

            //     return ok(issue);
            // }

            // if (req.url.endsWith(&quot;/notes/add/&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;POST&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let note: Note &#x3D; req.body.note;
            //     let issue: Issue &#x3D; _.find(this.fakeDb.Issues, i &#x3D;&gt; i.id &#x3D;&#x3D;&#x3D; note.issueId);

            //     if (!issue) {
            //         return error(&quot;The issue you&#x27;re trying to update doesn&#x27;t exist&quot;);
            //     }

            //     for (let i &#x3D; 0; i &lt; this.fakeDb.Issues.length; i++) {
            //         if (this.fakeDb.Issues[i].id &#x3D;&#x3D;&#x3D; issue.id) {
            //             this.fakeDb.Issues[i].statusId &#x3D; note.statusId;
            //             this.save();
            //             break;
            //         }
            //     }

            //     let maxNote: Note &#x3D; _.maxBy(this.fakeDb.Notes, n &#x3D;&gt; n.id);
            //     note.id &#x3D; ((maxNote &amp;&amp; maxNote.id) || 0) + 1;
            //     this.fakeDb.Notes.push(note);
            //     this.save();

            //     return ok(note);
            // }

            // if (req.url.endsWith(&quot;/users&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     // TODO: to properly do this we need an error interceptor
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let userResults &#x3D; [];
            //     this.fakeDb.Users.forEach(user &#x3D;&gt; {
            //         let userResult &#x3D; {
            //             id: user.id,
            //             email: user.email,
            //             username: user.username,
            //             firstName: user.firstName,
            //             lastName: user.lastName,
            //             userLevelId: user.userLevelId
            //         }

            //         userResults.push(userResult);
            //     });

            //     return ok(userResults);
            // }

            // if (req.url.match(/\/notes\/issue\/(\d+)/) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let urlParts &#x3D; req.url.split(&#x27;/&#x27;);
            //     let id &#x3D; +urlParts[urlParts.length - 1];

            //     return ok(_.orderBy(_.filter(this.fakeDb.Notes, n &#x3D;&gt; n.issueId &#x3D;&#x3D;&#x3D; id), [&#x27;id&#x27;], [&#x27;desc&#x27;]));
            // }

            // if (req.url.endsWith(&quot;/issues&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     return ok(this.fakeDb.Issues);
            // }

            // if (req.url.match(/\/issue\/\d+/) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let urlParts &#x3D; req.url.split(&#x27;/&#x27;);
            //     let id &#x3D; parseInt(urlParts[urlParts.length - 1]);

            //     return ok(_.find(this.fakeDb.Issues, i &#x3D;&gt; i.id &#x3D;&#x3D;&#x3D; id));
            // }

            // if (req.url.match(/\/issues\/assignedto\/\d+/) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let urlParts &#x3D; req.url.split(&#x27;/&#x27;);
            //     let id &#x3D; parseInt(urlParts[urlParts.length - 1]);

            //     return ok(_.filter(this.fakeDb.Issues, i &#x3D;&gt; i.assignedToId &#x3D;&#x3D;&#x3D; id));
            // }

            // if (req.url.match(/\/issues\/createdby\/\d+/) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let urlParts &#x3D; req.url.split(&#x27;/&#x27;);
            //     let id &#x3D; parseInt(urlParts[urlParts.length - 1]);

            //     return ok(_.filter(this.fakeDb.Issues, i &#x3D;&gt; i.createdById &#x3D;&#x3D;&#x3D; id));
            // }

            // if (req.url.match(/\/issues\/status\/(\d+)\/user\/(\d+)/) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {

            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     let urlParts &#x3D; req.url.split(&#x27;/&#x27;);
            //     let statusId &#x3D; parseInt(urlParts[urlParts.length - 3]);
            //     let userId &#x3D; parseInt(urlParts[urlParts.length - 1]);

            //     return ok(_.filter(this.fakeDb.Issues, i &#x3D;&gt; i.statusId &#x3D;&#x3D;&#x3D; statusId &amp;&amp; (i.assignedToId &#x3D;&#x3D;&#x3D; userId || i.createdById &#x3D;&#x3D;&#x3D; userId)));
            // }

            // if (req.url.endsWith(&quot;/statuses/&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     return ok(this.fakeDb.Statuses);
            // }

            // if (req.url.endsWith(&quot;/categories/&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     return ok(this.fakeDb.Categories);
            // }

            // if (req.url.endsWith(&quot;/priorities/&quot;) &amp;&amp; req.method &#x3D;&#x3D;&#x3D; &quot;GET&quot;) {
            //     if (!isLoggedIn) {
            //         return unauthorized();
            //     }

            //     return ok(_.orderBy(this.fakeDb.Priorities, [&#x27;delay&#x27;], [&#x27;asc&#x27;]));
            // }

            return next.handle(req);
        }))
            .pipe(materialize())
            .pipe(delay(200))
            .pipe(dematerialize());

        function ok(body) {
            return of(new HttpResponse({ status: 200, body }));
        }

        function unauthorized() {
            return throwError({ status: 401, message: &#x27;Unauthorized&#x27; });
        }

        function error(message) {
            return throwError({ status: 400, message: message });
        }
    }
}

export let fakeBackendProvider &#x3D; {
    // use fake backend in place of Http service for backend-less development
    provide: HTTP_INTERCEPTORS,
    useClass: FakeBackendInterceptor,
    multi: true
};</code></pre>
    </div>
</div>










                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interceptor';
            var COMPODOC_CURRENT_PAGE_URL = 'FakeBackendInterceptor.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
